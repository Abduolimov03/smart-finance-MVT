{% load humanize %}
<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kirimlar ro ªyxati</title>
<style>
  :root{
    --bg:#f4f6f8;
    --card:#ffffff;
    --primary:#1e3a8a;
    --accent:#3b82f6;
    --danger:#ef4444;
    --muted:#6b7280;
    --glass: rgba(255,255,255,0.6);
    --radius:12px;
    --shadow: 0 6px 18px rgba(17,24,39,0.06);
    font-family: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  /* page layout */
  html,body{height:100%; margin:0; background: linear-gradient(180deg, #f7fafc 0%, var(--bg) 100%);}
  .container{max-width:980px; margin:36px auto; padding:20px; box-sizing:border-box;}
  header.appbar{
    display:flex; align-items:center; justify-content:space-between;
    background:linear-gradient(90deg,var(--primary), #16295c);
    color:#fff; padding:20px;border-radius:14px; box-shadow:var(--shadow);
  }
  header .left {display:flex; align-items:center; gap:16px;}
  header h1{font-size:20px; margin:0; letter-spacing:0.2px;}
  header .sub{font-size:13px; color:rgba(255,255,255,0.9);}
  header .actions {display:flex; gap:10px; align-items:center;}
  a.btn { text-decoration:none; padding:9px 14px; border-radius:10px; font-weight:600; color:#fff; background:var(--accent); box-shadow:0 6px 12px rgba(59,130,246,0.12);}
  a.btn.secondary{ background:transparent; border:1px solid rgba(255,255,255,0.15); color:#fff; box-shadow:none; }
  a.btn.small{ padding:7px 10px; font-size:14px; border-radius:8px; }

  /* card */
  .card{background:var(--card); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); margin-top:18px;}
  .card h2{margin:0 0 12px 0; font-size:18px; color:#0f172a;}

  /* controls */
  .list-actions{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:12px;}
  .search {flex:1 1 260px; display:flex; gap:8px; align-items:center;}
  .search input{width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e6e9ee; background:#fafbfc; font-size:14px;}
  .filters {display:flex; gap:8px; align-items:center;}

  /* list */
  ul.income-list {list-style:none; padding:0; margin:0;}
  ul.income-list li{
    display:flex; align-items:center; justify-content:space-between;
    gap:12px; padding:14px; border-radius:10px; margin-bottom:10px;
    background: linear-gradient(180deg, #ffffff, #fbfdff);
    border: 1px solid rgba(15,23,42,0.03);
    box-shadow: 0 2px 6px rgba(2,6,23,0.03);
    transition:transform .12s ease, box-shadow .12s ease;
  }
  ul.income-list li:hover{ transform:translateY(-3px); box-shadow:0 10px 28px rgba(2,6,23,0.06); }

  .income-meta { display:flex; align-items:center; gap:12px; flex:1; min-width:0; }
  .avatar {
    width:44px; height:44px; border-radius:10px; background:linear-gradient(180deg,var(--accent),#2563eb);
    display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700;
    flex-shrink:0;
  }
  .meta-text { overflow:hidden; }
  .meta-text .title{ font-weight:700; color:#0b1220; display:block; white-space:nowrap; text-overflow:ellipsis; overflow:hidden; }
  .meta-text .subtitle{ font-size:13px; color:var(--muted); margin-top:3px; white-space:nowrap; text-overflow:ellipsis; overflow:hidden; }

  .amount { font-weight:800; min-width:160px; text-align:right; color:#0b1220; }
  .amount small{ display:block; font-weight:600; font-size:13px; color:var(--muted); margin-top:4px; }

  .item-actions { display:flex; gap:8px; align-items:center; margin-left:12px; }
  .action-btn { padding:8px 10px; border-radius:8px; text-decoration:none; font-weight:700; color:#fff; display:inline-block; font-size:14px; }
  .action-edit { background:linear-gradient(90deg,#06b6d4,#3b82f6); }
  .action-delete { background:linear-gradient(90deg,#fb7185,#ef4444); }

  /* empty state */
  .empty{
    text-align:center; padding:36px; color:var(--muted); border:1px dashed #e6e9ee; border-radius:10px;
  }

  /* back button */
  .back { display:inline-block; margin-top:12px; text-decoration:none; color:var(--primary); border:1px solid rgba(30,58,138,0.08); padding:8px 12px; border-radius:8px; font-weight:700; background:#fff; }

  /* responsive */
  @media(max-width:720px){
    .amount{ min-width:120px; text-align:left; }
    ul.income-list li{ flex-direction:column; align-items:flex-start; }
    .item-actions{ margin-left:0; margin-top:10px; }
  }
</style>
</head>
<body>
  <div class="container">
    <header class="appbar">
      <div class="left">
        <div>
          <h1>Kirimlar ro ªyxati</h1>
          <div class="sub">Foydalanuvchi: {{ request.user.username }}</div>
        </div>
      </div>
      <div class="actions">
        <a href="{% url 'income_add' %}" class="btn small">‚ûï Yangi kirim</a>
        <a href="{% url 'home' %}" class="btn small secondary">üè† Bosh sahifa</a>
      </div>
    </header>

    <div class="card" style="margin-top:18px;">
      <div class="list-actions">
        <div class="search">
          <form method="get" action="{% url 'income_list' %}" style="display:flex;width:100%;gap:8px;">
            <input type="text" name="q" placeholder="Qidiruv (nom, to ªlov usuli...)" value="{{ request.GET.q|default:'' }}">
            <button class="btn small" type="submit">Qidirish</button>
          </form>
        </div>

        <div class="filters">
          <form method="get" action="{% url 'income_list' %}" style="display:flex; gap:8px; align-items:center;">
            <input type="date" name="start_date" value="{{ start_date|default:'' }}" />
            <input type="date" name="end_date" value="{{ end_date|default:'' }}" />
            <button class="btn small" type="submit">Filtr</button>
          </form>
        </div>
      </div>

      {% if range_total %}
        <p style="margin:8px 0 16px 0; font-weight:700;">Tanlangan davr kirimi: <span style="color:#0b1220;">{{ range_total|intcomma }} so'm</span></p>
      {% endif %}

      {% if incomes %}
      <ul class="income-list">
        {% for income in incomes %}
        <li>
          <div class="income-meta">
            <div class="avatar">{{ income.title|slice:":1"|upper }}</div>
            <div class="meta-text">
              <span class="title">{{ income.title }}</span>
              <span class="subtitle">{{ income.payment_method|capfirst }} ‚Ä¢ {{ income.created_at|date:"d M Y, H:i" }}</span>
            </div>
          </div>

          <div class="amount">
            {{ income.amount|intcomma }} so'm
            <small>ID: {{ income.id }}</small>
          </div>

          <div class="item-actions">
            <a href="{% url 'income_update' income.id %}" class="action-btn action-edit">‚úèÔ∏è Tahrirlash</a>
            <a href="{% url 'income_delete' income.id %}" class="action-btn action-delete">üóë O'chirish</a>
          </div>
        </li>
        {% endfor %}
      </ul>
      {% else %}
        <div class="empty">
          <h3>Bu vaqt oraligida kirimlar mavjud emas</h3>
          <p>Yangi kirim qo ªshish uchun pastdagi tugmani bosing.</p>
          <div style="margin-top:12px;">
            <a href="{% url 'income_add' %}" class="btn">‚ûï Kirim qo ªshish</a>
            <a href="{% url 'home' %}" class="back">Bosh sahifaga qaytish</a>
          </div>
        </div>
      {% endif %}

    </div>
  </div>
</body>
</html>
